branches:
  only:
    - master
    - develop
    - /^v\d+\.\d+$/


image: Visual Studio 2022

configuration: Release

environment:
  QTDIR: C:\Qt\6.1.3\mingw81_64
  MINGWDIR: C:\Qt\Tools\mingw810_64

install:
    - set PATH=%QTDIR%\bin;%MINGWDIR%\bin;%PATH%

before_build:
    - qmake arsenic.pro

build_script:
    - qmake CONFIG+=release arsenic.pro
    - mingw32-make
    
after_build:   
    - cd %APPVEYOR_BUILD_FOLDER%
    - mkdir arsenic_win_x64
    - cd arsenic_win_x64
    - xcopy %APPVEYOR_BUILD_FOLDER%\arsenic\release\arsenic.exe %APPVEYOR_BUILD_FOLDER%\arsenic_win_x64\
    - xcopy %APPVEYOR_BUILD_FOLDER%\tests\release\tests.exe %APPVEYOR_BUILD_FOLDER%\arsenic_win_x64\
    - xcopy %APPVEYOR_BUILD_FOLDER%\arsenic_gui\release\arsenic_gui.exe %APPVEYOR_BUILD_FOLDER%\arsenic_win_x64\
    - xcopy %APPVEYOR_BUILD_FOLDER%\arscore\build\arscore.dll %APPVEYOR_BUILD_FOLDER%\arsenic_win_x64\
    - xcopy %APPVEYOR_BUILD_FOLDER%\arsenic_gui\languages %APPVEYOR_BUILD_FOLDER%\arsenic_win_x64\languages /E /Y /I
    - windeployqt arsenic_gui.exe
    

artifacts:
    - path: arsenic_win_x64
      type: zip

# deploy tagged releases to Github releases
deploy:
 provider: GitHub
 on:
   branch: master
   appveyor_repo_tag: true
 auth_token:
    secure: +tfhnWlsWPfHXUdLqWA8LjT0q9toLiCuBZBUs+tRXLKTYOaxNpwZ/ezF25o8uvv+
 artifact: arsenic_win_x64.zip
 draft: false
 prerelease: false
 tag: $(APPVEYOR_REPO_TAG_NAME)
 release: $(APPVEYOR_REPO_TAG_NAME)
 description: $(APPVEYOR_REPO_COMMIT_MESSAGE)

### To deploy :
### git tag -a v1.3 -m "Version 1.3"
### git push origin v1.3

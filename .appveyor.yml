image: Visual Studio 2022

configuration: Release

install:
    - set QTDIR=C:\Qt\6.1.3\mingw81_64
    - set MINGW=C:\Qt\Tools\mingw810_64
    - ps: Start-FileDownload 'http://www.jrsoftware.org/download.php/is.exe' is.exe
    - is.exe /VERYSILENT /SUPPRESSMSGBOXES /NORESTART /SP-
    - set PATH=%QTDIR%\bin;%MINGW%\bin;%PATH%;"C:\Program Files (x86)\Inno Setup 6"

build_script:
    - qmake CONFIG+=release arsenic.pro
    - mingw32-make
    
after_build:   
    - windeployqt arsenic_gui.exe
    - dir
    - rm release/*.o
    - rm release/*.cpp
    - rm release/*.h
    - iscc ./installer/installer.iss

artifacts:
    - path: Output/arsenic_gui-*.exe
      name: SetupExe

deploy:
      - provider: GitHub
        release: $(appveyor_repo_tag_name)
        description: 'Release of arsenic v${appveyor_repo_tag_name}'
        draft: false
        prerelease: false
        do_rel: true
        auth_token:
          secure: +tfhnWlsWPfHXUdLqWA8LjT0q9toLiCuBZBUs+tRXLKTYOaxNpwZ/ezF25o8uvv+
        artifact: SetupExe
        force_update: true
        on:
          appveyor_repo_tag: true      # deploy on tag push only

### To deploy :
### git tag -a v1.3 -m "Version 1.3"
### git push origin v1.3

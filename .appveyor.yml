version: 1.0.{build}

branches:
  only:
    - master

skip_tags: true

image: Visual Studio 2022

configuration: Release

environment:
  QTDIR: C:\Qt\6.2.2\mingw_64
  MINGWDIR: C:\Qt\Tools\mingw810_64

install:
    - cmd: appveyor DownloadFile http://tripleboot.org/Uploads/windeployqt64releaseonly.zip
    - cmd: 7z e windeployqt64releaseonly.zip -o%QTDIR%\..\..\Tools\mingw810_64\bin

before_build:
    - cmd: set PATH=%QTDIR%\bin;%QTDIR%\..\..\Tools\mingw810_64\bin;C:\Program Files (x86)\NSIS\;%PATH%
    - cmd: echo PATH=%PATH%    

build_script:
    - qmake CONFIG+=release arsenic.pro -spec win32-g++
    - mingw32-make
    
after_build:   
    - cd %APPVEYOR_BUILD_FOLDER%
    - mkdir arsenic_win_x64
    - cd arsenic_win_x64
    - xcopy %APPVEYOR_BUILD_FOLDER%\arsenic\release\arsenic.exe %APPVEYOR_BUILD_FOLDER%\arsenic_win_x64\
    - xcopy %APPVEYOR_BUILD_FOLDER%\tests\release\tests.exe %APPVEYOR_BUILD_FOLDER%\arsenic_win_x64\
    - xcopy %APPVEYOR_BUILD_FOLDER%\arsenic_gui\release\arsenic_gui.exe %APPVEYOR_BUILD_FOLDER%\arsenic_win_x64\
    - xcopy %APPVEYOR_BUILD_FOLDER%\arscore\build\arscore.dll %APPVEYOR_BUILD_FOLDER%\arsenic_win_x64\
    - xcopy %APPVEYOR_BUILD_FOLDER%\arsenic_gui\languages %APPVEYOR_BUILD_FOLDER%\arsenic_win_x64\languages /E /Y /I
    - windeployqt arsenic_gui.exe
    

artifacts:
    - path: arsenic_win_x64
      type: zip
